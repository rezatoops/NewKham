@using Core.Services.Interfaces;
@using Core.ViewModel

@model ProductViewModel

@inject IToolsService _toolsService

<div id="LoadingPage">
    <div class="sk-loading">
        <div class="sk-spinner sk-spinner-double-bounce">
            <div class="sk-double-bounce1"></div>
            <div class="sk-double-bounce2"></div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 no-padding">
        <div style="margin-top:20px">
            <div class="ibox-content">
                <div style="float:right;">
                    @{
                        if (Model.CurrentPage > 3)
                        {

                            <a class="NavigateNumber bg-muted" asp-controller="Product" asp-action="GetProducts" asp-route-search="@Model.SearchTerm" asp-route-pageNumber=1 asp-route-countPerPage=@Model.CountPerPage data-ajax="true" data-ajax-method="POST" data-ajax-update="#ProductTable" data-ajax-mode="replace">اولین</a>
                            <span style="float:right;"> . . . </span>
                        }

                        foreach (var item in _toolsService.GetNavNumbers(Model.CurrentPage, Model.AllPage))
                        {
                            if (item == Model.CurrentPage)
                            {
                                <span class="NavigateNumber bg-primary">@item.ToString()</span>
                            }
                            else
                            {
                                <a class="NavigateNumber bg-muted"
                       asp-controller="Product" asp-action="GetProducts" asp-route-search="@Model.SearchTerm" asp-route-pageNumber=@item asp-route-countPerPage=@Model.CountPerPage data-ajax="true" data-ajax-method="POST" data-ajax-update="#ProductTable" data-ajax-mode="replace">@item.ToString()</a>

                            }
                        }
                        if (Model.CurrentPage < Model.AllPage - 2)
                        {
                            <span style="float:right;"> . . . </span>
                            //@Ajax.ActionLink("آخرین", "GetSpecificComments", "Comment", new { pageNumber = lastPage }, new AjaxOptions { UpdateTargetId = "CommentTable", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", LoadingElementId = "LoadingPage" }, new { @class = "NavigateNumber bg-muted" })
                            <a class="NavigateNumber bg-muted" asp-controller="Product" asp-action="GetProducts" asp-route-search="@Model.SearchTerm" asp-route-pageNumber=@Model.AllPage asp-route-countPerPage=@Model.CountPerPage data-ajax="true" data-ajax-method="POST" data-ajax-update="#ProductTable" data-ajax-mode="replace">آخرین</a>

                        }
                    }
                    <div class="clear"></div>
                </div>

                <div style="float: left; width:300px;">
                    <form asp-controller="Product" asp-action="GetProducts" data-ajax="true" data-ajax-method="POST" data-ajax-update="#ProductTable" data-ajax-mode="replace">
                        <div class="input-group">
                            <input type="hidden" name="pageNumber" value="1" />
                            <input type="hidden" name="countPerPage" value="@Model.CountPerPage" />
                            <input type="text" name="search" class="form-control" />
                            <span class="input-group-btn">
                                <button type="submit" class="btn btn-primary">
                                    جستجو کن
                                </button>
                            </span>
                        </div>
                    </form>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>



<div class="row">
    <div class="col-lg-12 no-padding">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>محصولات</h5>

                <div style="float:right; margin-right: 20px;margin-top: -1px;">
                    @if (Model.SearchTerm != null)
                    {
                        <span>کلمه جستجو شده: @Model.SearchTerm</span>
                        <span>
                            <button onclick="location.href='@Url.Action("Index", "Product")'" class="btn btn-danger btn-circle" style="width: 15px;height: 16px;margin-bottom: 0px;padding: 2px 0px 0px 0px;font-size: 10px;" type="button">
                                <i class="fa fa-times"></i>
                            </button>
                        </span>
                    }
                </div>

                <div style="float:left;">
                    <a class="btn btn-success" asp-controller="Product" asp-action="Publish" type="button" style="margin: -10px 0px 0px 4px;"><i class="fa fa-plus" style="margin-top: 3px;float: right;margin-left: 5px;"></i> &nbsp;محصول جدید</a>
                </div>
            </div>
            <div class="ibox-content">

                <table class="table table-striped table-bordered table-hover dataTables-user" style="table-layout: fixed;">
                    <thead>
                        <tr>
                            <th class="col-lg-2">تصویر</th>
                            <th class="col-lg-4">نام محصول</th>
                            <th class="col-lg-2">قیمت</th>
                            <th class="col-lg-1">تعداد موجودی</th>
                            <th class="col-lg-1">تعداد فروش</th>
                            <th class="col-lg-2">عملیات</th>
                        </tr>
                    </thead>

                    <tbody>
                        @{
                            foreach (var item in Model.products)
                            {
                                string productClass = "product_" + item.Id;
                                <tr id="@productClass" class="gradeX anyuser">
                                    @await Html.PartialAsync("_productRow", item)

                                </tr>
                            }
                        }

                    </tbody>
                    <tfoot>
                        <tr>
                            <th class="col-lg-2">تصویر</th>
                            <th class="col-lg-4">نام محصول</th>
                            <th class="col-lg-2">قیمت</th>
                            <th class="col-lg-1">تعداد موجودی</th>
                            <th class="col-lg-1">تعداد فروش</th>
                            <th class="col-lg-2">عملیات</th>
                        </tr>
                    </tfoot>
                </table>

            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 no-padding">
        <div style="margin-top:-20px;margin-bottom: 60px;">
            <div class="ibox-content">
                <div style="height:20px;">
                    @*                    @{
                    if (currentPage > 3)
                    {
                    @Ajax.ActionLink("اولین", "GetSpecificComments", "Comment", new { pageNumber = 1 }, new AjaxOptions { UpdateTargetId = "CommentTable", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", LoadingElementId = "LoadingPage" }, new { @class = "NavigateNumber bg-muted" })
                    <span style="float:right;"> . . . </span>
                    }

                    foreach (var item in R_comment.GetNavNumbers())
                    {
                    if (item == currentPage)
                    {
                    <span class="NavigateNumber bg-primary">@item.ToString()</span>
                    }
                    else
                    {
                    @Ajax.ActionLink(item.ToString(), "GetSpecificComments", "Comment", new { pageNumber = item }, new AjaxOptions { UpdateTargetId = "CommentTable", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", LoadingElementId = "LoadingPage" }, new { @class = "NavigateNumber bg-muted" })
                    }
                    }
                    if (currentPage < lastPage - 2)
                    {
                    <span style="float:right;"> . . . </span>
                    @Ajax.ActionLink("آخرین", "GetSpecificComments", "Comment", new { pageNumber = lastPage }, new AjaxOptions { UpdateTargetId = "CommentTable", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", LoadingElementId = "LoadingPage" }, new { @class = "NavigateNumber bg-muted" })

                    }
                    }*@
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

